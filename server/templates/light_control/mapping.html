{% extends 'base.html' %}
{% load static %}
{% block title %}{{ title }} - mp_Net-Light{% endblock %}

{% block content %}
<div class="content">
  <h2 style="color:#667eea; margin-bottom:12px;">ğŸ§© Mapping Editorï¼ˆæ¯ slave ä¸€ä»½ mappingï¼‰</h2>
  
  <div style="display:flex; gap:16px; flex-wrap:wrap;">
    <!-- å·¦å´ï¼šCanvas ç•«æ¿ -->
    <div style="flex: 1 1 780px;">
      <canvas id="board" style="width:100%; border:1px solid #e5e7eb; border-radius:8px; image-rendering:pixelated;"></canvas>
      <div style="color:#666; margin-top:8px; font-size:0.9rem;">
        ğŸ’¡ é»æ ¼å­é¸å– â†’ è¨­ pxld_id / mcu_id â†’ ä¿å­˜åˆ° mapping_slave_{id}.json
      </div>
    </div>

    <!-- å³å´ï¼šæ§åˆ¶é¢æ¿ -->
    <div style="flex: 0 0 360px;">
      <div style="display:grid; gap:10px;">
        
        <!-- PXLD æª”æ¡ˆ -->
        <label style="font-weight:600; color:#374151;">PXLD æª”å</label>
        <input id="pxldName" value="show.pxld" style="padding:8px; border:1px solid #d1d5db; border-radius:6px;">

        <!-- Slave é¸æ“‡ -->
        <label style="font-weight:600; color:#374151; margin-top:8px;">Slave é¸æ“‡</label>
        <select id="slaveSelect" style="padding:8px; border:1px solid #d1d5db; border-radius:6px;">
          <option value="-1">ç¸½ç•«æ¿</option>
        </select>

        <!-- æ’­æ”¾æ§åˆ¶ -->
        <div style="margin-top:12px; padding-top:12px; border-top:1px solid #e5e7eb;">
          <label style="font-weight:600; color:#374151; margin-bottom:8px; display:block;">æ’­æ”¾æ§åˆ¶</label>
          <div style="display:flex; gap:8px;">
            <button class="btn" id="playBtn" style="flex:1;">â–¶ï¸</button>
            <button class="btn" id="pauseBtn" style="flex:1;">â¸ï¸</button>
            <button class="btn" id="stopBtn" style="flex:1;">â¹ï¸</button>
          </div>
          
          <label style="font-size:0.9rem; color:#6b7280; margin-top:10px; display:block;">Frame</label>
          <input id="frameSlider" type="range" min="0" max="0" value="0" style="width:100%;">
          <div id="frameInfo" style="color:#666; font-size:0.85rem; text-align:center;">frame: 0</div>
        </div>

        <!-- é¸ä¸­æ ¼å­è³‡è¨Š -->
        <div style="background:#f3f4f6; padding:12px; border-radius:8px; margin-top:12px;" id="pickedInfo">
          é»æ“Šæ ¼å­ä»¥é¸å–
        </div>

        <!-- Mapping ç·¨è¼¯ -->
        <label style="font-weight:600; color:#374151; margin-top:8px;">pxld_idï¼ˆæª”æ¡ˆå…§é †åºï¼‰</label>
        <input id="pxldId" type="number" value="0" style="padding:8px; border:1px solid #d1d5db; border-radius:6px;">

        <label style="font-weight:600; color:#374151;">mcu_led_idï¼ˆå¯¦éš›ç‡ˆåºï¼‰</label>
        <input id="mcuId" type="number" value="0" style="padding:8px; border:1px solid #d1d5db; border-radius:6px;">

        <!-- æ“ä½œæŒ‰éˆ• -->
        <button class="btn" id="applyBtn" style="margin-top:8px;">âœ“ å¥—ç”¨åˆ°æ­¤æ ¼</button>
        <button class="btn" id="saveBtn" style="background:#111827; margin-top:4px;">ğŸ’¾ ä¿å­˜ï¼ˆæ­¤ slaveï¼‰</button>

        <!-- è¨Šæ¯é¡¯ç¤º -->
        <div id="msg" style="color:#059669; font-size:0.9rem; min-height:20px; margin-top:8px;"></div>
      </div>
    </div>
  </div>
</div>

<!-- âœ… é—œéµï¼šåŠ å…¥ CSRF token -->
{% csrf_token %}

<!-- æ¨¡å¡ŠåŒ–ç‰ˆæœ¬ï¼ˆä¸»è¦ï¼‰ -->
<!-- ç›´æ¥åŠ è¼‰å–®æ–‡ä»¶ç‰ˆæœ¬ -->
<script src="{% static 'netlight/js/mapping-single.js' %}"></script>

<!-- å¯é¸ï¼šå¦‚æœæƒ³è¦æ¨¡å¡ŠåŒ–ç‰ˆæœ¬ï¼Œä¿ç•™é€™å€‹ -->
<!-- <script type="module" src="{% static 'netlight/js/mapping.js' %}"></script> -->
{% endblock %}
{% endblock %}