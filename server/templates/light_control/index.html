<!-- templates/light_control/index.html -->
{% extends 'base.html' %}

{% block title %}{{ title }} - mp_Net-Light{% endblock %}

{% block content %}
<div class="stats">
    <div class="stat-card">
        <h3>ğŸ“± ç¸½è¨­å‚™æ•¸</h3>
        <div class="stat-value">{{ total_devices }}</div>
    </div>
    
    <div class="stat-card">
        <h3>âœ… åœ¨ç·šè¨­å‚™</h3>
        <div class="stat-value">
            <span class="status-indicator status-online"></span>
            {{ online_devices }}
        </div>
    </div>
    
    <div class="stat-card">
        <h3>ğŸ’¡ å¯ç”¨ç‡ˆæ•ˆ</h3>
        <div class="stat-value">{{ total_effects }}</div>
    </div>
</div>

<div class="content">
    <h2 style="margin-bottom: 20px; color: #667eea;">ğŸ¯ å¿«é€Ÿé–‹å§‹</h2>
    
    <div style="margin-bottom: 20px;">
        <h3 style="color: #764ba2; margin-bottom: 10px;">1. ä¼ºæœå™¨è³‡è¨Š</h3>
        <p style="line-height: 1.8;">
            <strong>WebSocket åœ°å€:</strong> <code>ws://your-server-ip:8000/ws/light/{device_id}/</code><br>
            <strong>REST API:</strong> <code>http://your-server-ip:8000/api/</code>
        </p>
    </div>
    
    <div style="margin-bottom: 20px;">
        <h3 style="color: #764ba2; margin-bottom: 10px;">2. åŠŸèƒ½èªªæ˜</h3>
        <ul style="line-height: 2; padding-left: 20px;">
            <li>âœ¨ å¯¦æ™‚ WebSocket é€šä¿¡æ§åˆ¶ç‡ˆæ•ˆ</li>
            <li>ğŸ¨ æ”¯æŒå¤šç¨®ç‡ˆæ•ˆæ¨¡å¼</li>
            <li>ğŸ“Š è¨­å‚™ç‹€æ…‹ç›£æ§</li>
            <li>ğŸ“ å‘½ä»¤åŸ·è¡Œæ—¥èªŒ</li>
            <li>ğŸ”§ RESTful API æ¥å£</li>
        </ul>
    </div>
    
    <div style="margin-bottom: 30px;">
        <h3 style="color: #764ba2; margin-bottom: 10px;">3. API ç«¯é»</h3>
        <table>
            <tr>
                <th>ç«¯é»</th>
                <th>æ–¹æ³•</th>
                <th>èªªæ˜</th>
            </tr>
            <tr>
                <td><code>/api/devices/</code></td>
                <td>GET</td>
                <td>ç²å–æ‰€æœ‰è¨­å‚™</td>
            </tr>
            <tr>
                <td><code>/api/devices/{id}/send_command/</code></td>
                <td>POST</td>
                <td>ç™¼é€å‘½ä»¤åˆ°è¨­å‚™</td>
            </tr>
            <tr>
                <td><code>/api/effects/</code></td>
                <td>GET</td>
                <td>ç²å–æ‰€æœ‰ç‡ˆæ•ˆ</td>
            </tr>
            <tr>
                <td><code>/api/logs/</code></td>
                <td>GET</td>
                <td>ç²å–å‘½ä»¤æ—¥èªŒ</td>
            </tr>
        </table>
    </div>
    
    <div style="text-align: center;">
        <a href="/light/dashboard/" class="btn">é€²å…¥æ§åˆ¶å° â†’</a>
        <a href="/admin/" class="btn" style="margin-left: 10px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">ç®¡ç†å¾Œå°</a>
    </div>
</div>

<div class="content" style="margin-top: 20px;">
    <h2 style="margin-bottom: 20px; color: #667eea;">ğŸ“¡ MicroPython å®¢æˆ¶ç«¯ç¤ºä¾‹</h2>
    <pre><code># main.py - MicroPython å®¢æˆ¶ç«¯ç¤ºä¾‹
import network
import time
import json

# WiFi è¨­å®š
SSID = 'your-wifi-ssid'
PASSWORD = 'your-wifi-password'

# ä¼ºæœå™¨è¨­å®š
SERVER = 'your-server-ip'
PORT = 8000
DEVICE_ID = 'esp32_001'

def connect_wifi():
    """é€£æ¥ WiFi"""
    wlan = network.WLAN(network.STA_IF)
    wlan.active(True)
    if not wlan.isconnected():
        print('æ­£åœ¨é€£æ¥ WiFi...')
        wlan.connect(SSID, PASSWORD)
        while not wlan.isconnected():
            time.sleep(1)
    print('WiFi å·²é€£æ¥:', wlan.ifconfig())
    return wlan

def main():
    """ä¸»ç¨‹åº"""
    print('=' * 40)
    print('mp_Net-Light å®¢æˆ¶ç«¯')
    print('=' * 40)
    
    # é€£æ¥ WiFi
    wlan = connect_wifi()
    
    # WebSocket å®¢æˆ¶ç«¯å°‡åœ¨ä¸‹ä¸€éšæ®µå¯¦ç¾
    print('æº–å‚™é€£æ¥åˆ°ä¼ºæœå™¨...')
    print(f'WebSocket URL: ws://{SERVER}:{PORT}/ws/light/{DEVICE_ID}/')
    
if __name__ == '__main__':
    main()
</code></pre>
</div>

<div class="content" style="margin-top: 20px;">
    <h2 style="margin-bottom: 20px; color: #667eea;">ğŸ“š ä½¿ç”¨èªªæ˜</h2>
    <ol style="line-height: 2; padding-left: 20px;">
        <li>é»æ“Š <strong>"é€²å…¥æ§åˆ¶å°"</strong> æŸ¥çœ‹æ‰€æœ‰è¨­å‚™å’Œæ§åˆ¶ç‡ˆæ•ˆ</li>
        <li>é»æ“Š <strong>"ç®¡ç†å¾Œå°"</strong> é€²è¡Œç³»çµ±ç®¡ç† (éœ€è¦ç™»å…¥)</li>
        <li>ä½¿ç”¨ REST API é€²è¡Œç¨‹åºåŒ–æ§åˆ¶</li>
        <li>MicroPython è¨­å‚™é€šé WebSocket é€£æ¥ä¸¦æ¥æ”¶å‘½ä»¤</li>
    </ol>
</div>
{% endblock %}